---

layout: page
title: "Install"
category: greenlight_v3
date: 2022-09-08 16:29:25
order: 1

---

---

# **Beta release**
**IMPORTANT NOTE**

Greenlight v3 is still in Beta. Therefore, it is **NOT** a production ready application. It contains some missing/incomplete features and should only be used for testing purposes.

For any suggestions, notes, encountered issues or questions, please refer to the Greenlight official repository: [http://github.com/bigbluebutton/greenlight/](http://github.com/bigbluebutton/greenlight/)
or the Google community group: [https://groups.google.com/g/bigbluebutton-greenlight](https://groups.google.com/g/bigbluebutton-greenlight)

---
# What is Greenlight?
Greenlight is an open source [LGPL-3.0 licensed](https://github.com/bigbluebutton/greenlight/blob/master/LICENSE) web application that enables organizations having a BigBlueButton server with a complete web conferencing platform in a matter of minutes while being simple to set and to use for both regular and power users.

Greenlight v3 is a full stack web application built with the latest versions of [Ruby on Rails](https://rubyonrails.org/) and [React](https://reactjs.org/). This stack empowers millions of projects and is trusted by big corporations, and is conforming with Greenlight's licensing subject and the expectations of our community.


# Installation steps
## Prerequisites

The following guide requires that your system has two valid FQDNs (Fully Qualified Domain Names) one for Greenlight and another Keycloak that we will configure the applications to expect**.**

So, for example, an organization with a valid public domain name of **[xlab.bigbluebutton.org](http://xlab.bigbluebutton.org)** may create two DNS records: one with the hostname “**gl**”, and another one “**kc**”, forming two valid public FQDNs that points to their system public IP address on which to deploy Greenlight.

We will configure the scripts and services afterwards to use the valid public FQDNs, that is in our example: [gl.xlab.bigbluebutton.org](http://gl.xlab.bigbluebutton.org) and [kc.xlab.bigbluebutton.org](http://kc.xlab.bigbluebutton.org).

***To create these new FQDNs, please refer to your DNS registrar and* follow** ***their guides on how to add new records.***

Once the new records have been added, it may take some time for the DNS updates to propagate through the network. Please make sure that the records are available before continuing. You can refer to these platforms for verification [https://www.whatsmydns.net/](https://www.whatsmydns.net/).

We also expect that both of the FQDNs point to your system public IP address and that the web ports **HTTP(TCP 80)** and **HTTPS(TCP 443)** _are open for inbound traffic_.

---

## Installing Docker
To run Greenlight, you must install Docker Engine alongside a Docker Client. You have 2 options: 
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) (recommended for Windows systems)
- [Docker Engine + Client](https://docs.docker.com/engine/install/) & [Docker Compose Plugin](https://docs.docker.com/compose/install/compose-plugin/) (recommended for UNIX systems)

Note: Some systems may be using the docker-compose utility.
***In these guides we will be using `docker compose` in the commands, but you can still use `docker-compose` utility in place without any issues.***


If docker dependencies are installed correctly, running the following commands should have a similar output:
```bash
sudo docker version
sudo docker compose version # sudo docker-compose version
```

![Docker Version](/images/greenlight/v3/install/docker-version.png)

***NOTE: You do not have to install both docker compose and docker-compose. You may use either to follow the guides.***

---

## Cloning the repository

A few deployment scripts to facilitate the setup of Greenlight are included in the dedicated GitHub [public repository](https://github.com/bigbluebutton/greenlight-run/).

The scripts are written in Bash. If your system does not have Bash installed, and you run into issues, please refer to your distribution documentation on how to install Bash. The scripts **are expecting the Bash binaries to be under “/bin/bash”.**

Start by cloning the repository in the local system. For that, the **git** CLI needs to be installed. To verify that `git` is installed, you can run:

```bash
git version
```

There should be a message indicating the installed version in your system.

![Git Version](/images/greenlight/v3/install/git-version.png)

If it is not installed, please refer to the official documentations on how to install **git.**

Go to the home directory:

```bash
cd ~
```

To clone the repository, run the following:

```bash
git clone https://github.com/bigbluebutton/greenlight-run.git
cd greenlight-run
```

---
## Setting environmental variables

To setup the `.env` files, run the following commands: 
```bash
cp data/greenlight/dotenv data/greenlight/.env
cp dotenv .env
```

In v3, there are 2 main `.env` files:
- `~/greenlight-run/.env` (for the deployment)
- `~/greenlight-run/data/greenlight/.env` (Greenlight **.env** file)

Most of the required variables are preset by default, but there are a few that we'd have to set manually.

The variables in the .**env** files can be edited by uncommenting (if commented) the line that defines the variable and change the values with the following syntax `VARIABLE_NAME=<VALUE>`.

We'd need to set the Postgres and Keycloak admin user passwords.
Please note that it is highly recommended to generate secure complex random secrets and passwords - it is suggested **not** to set those variables manually.

For convenience, these commands can be run to auto generate secure random complex secrets:

```bash
sed -i "s/SECRET_KEY_BASE=.*/SECRET_KEY_BASE=$(openssl rand -hex 64)/" data/greenlight/.env
psql_pwd="$(openssl rand -hex 40)";kc_pwd="$(openssl rand -hex 40)"
sed -i "s/POSTGRES_PASSWORD=.*/POSTGRES_PASSWORD=$psql_pwd/" .env
sed -i "s/KEYCLOAK_PASSWORD=.*/KEYCLOAK_PASSWORD=$kc_pwd/" .env
sed -i "s/DATABASE_URL=.*/DATABASE_URL=postgres:\/\/postgres:$psql_pwd@postgres:5432/" data/greenlight/.env
unset psql_pwd kc_pwd;
```

Now both passwords were generated and the **.env** files were updated accordingly.
> Note: Whatever is in $KEYCLOAK_PASSWORD will be your Keycloak admin account password.

Some services on Greenlight needs the FQDNs of Greenlight and Keycloak.
Therefore we invite you to set these variables manually by editing the deployment **.env** file as follow:
- **$DOMAIN_NAME**: The domain name of the applications, along with a hostname it will form the application FQDN (in practice its the common suffix between Greenlight and Keycloak FQDNs).
- **GL_HOSTNAME**: Greenlight hostname, the Greenlight FQDN will the be "**$GL_HOSTNAME.$DOMAIN_NAME**".
- **KC_HOSTNAME**: Keycloak hostname, the Keycloak FQDN will then be "**$KC_HOSTNAME.$DOMAIN_NAME**".

Example: If your Greenlight FQDN was **gl.demo.bigbluebutton.org** and Keycloak's was **kc.demo.bigbluebutton.org**. we'll have the following values set:
```
DOMAIN_NAME=demo.bigbluebutton.org
GL_HOSTNAME=gl
KC_HOSTNAME=kc
```
If your Greenlight FQDN was **demo.bigbluebutton.org** and Keycloak's was **kc.demo.bigbluebutton.org**. we'd set the **.env** variables to:
```
DOMAIN_NAME=bigbluebutton.org
GL_HOSTNAME=demo
KC_HOSTNAME=kc.demo
```
By default, we assume that **GL_HOSTNAME** is **"gl"** and **KC_HOSTNAME** is **"kc"** so change that to meet your environment.

---
## Keycloak & Authentication

In v3, Greenlight offers 3 ways of handling authentication:
1.  Local Accounts
2.  External Authentication via an OIDC (OpenID connect) provider

By default, Greenlight ships with Keycloak as its OIDC provider to enable system administrators with an easy way to configure authentication and support multi identity providers.

>If you don't plan on using Keycloak, you can skip this section and see [Removing Keycloak](/greenlight_v3/gl3-keycloak.html#removing-keycloak) before proceeding to the rest of the install steps.

>To connect to another authentication broker through OpenID other than Keycloak, see also [Connecting to Another OpenID Provider](/greenlight_v3/gl3-keycloak.html#connecting-to-another-openid-provider).

To use Keycloak we'd need to create its database, so kindly run the following commands:

```bash
sudo docker compose up postgres -d
```

Wait a few seconds, then create the keycloak database needed by Keycloak application by running the following:

```bash
sudo docker exec -it postgres psql -U postgres -c 'CREATE DATABASE keycloakdb;'
```

It should output something similar to this:

![Keycloak DB](/images/greenlight/v3/install/keycloak-db.png)

---

## Generating SSL certificates
Some features on Greenlight and Keycloak will **NOT** work without having a secure HTTPS connection. To simplify the deployment process because of that requirement we provide a simple automated script `init-letsencrypt.sh` to generate Letsencrypt certificates. The deployment will also be in charge of handling the renewal of certificates seamlessly.

>Please note that Greenlight will not work unless valid SSL certificates were provided.
>So either generate your SSL certificates with Letsencrypt and for that you can rely on the `init-letsencrypt.sh` script.
>OR if you have pre-owned certificates you're willing to use instead, please refer to [Custom Certificates](/greenlight_v3/gl3-certificates.html#custom-certificates) before proceeding and ignore this section.

To use the `init-letsencrypt.sh` script, you should add an email address to be registered when issuing the certificates. Kindly add an email address in the deployment **.env** file to:
```
LETSENCRYPT_EMAIL= # The email to use to subscribe to Letsencrypt expiry notices.
```
After setting your email and saving the changes to the deployment **.env** file, kindly run the automated script to claim your SSL certificates signed by Letsencrypt.
```
sudo ./init-letsencrypt.sh -n -r
```
If you like a more interactive experience, kindly run instead:
```
sudo ./init-letsencrypt.sh
```
When the script completes, we'd have a valid signed SSL certificates issued by Letsencrypt and ready for usage by Greenlight services. 

## Starting Greenlight

Now that everything is set, start the Greenlight services through docker compose:

```bash
 sudo docker compose up -d
```

Verify the containers status by running:

```bash
sudo docker container ls
```

It should output something similar to this:

![Docker Containers](/images/greenlight/v3/install/containers.png)

***Note: If you have followed the steps on how to disable Keycloak, it is normal to have a slightly different output that looks similar but does not contain the Keycloak container.***

Notice the **Up** status of all the Greenlight services, which indicate that they are up and running without any issues.

Now, you should be able to access your Greenlight and and Keycloak instances through their URLs.

For example, for **DOMAIN_NAME=xlab.bigbluebutton.org, GL_HOSTNAME=gl and KC_HOSTNAME=kc**, Greenlight is accessible at [https://gl.xlab.bigbluebutton.org/](https://gl.xlab.bigbluebutton.org/) and Keycloak at [https://kc.xlab.bigbluebutton.org](https://gl.xlab.bigbluebutton.org/).

***If you receive a 502 Bad Gateway error, please wait a few seconds and refresh the page.***
***If you see the nginx welcome page, restart the nginx service `sudo docker compose restart nginx`***

## What to do next?
Well not much, you may like to configure your Keycloak instance to add in support for identity providers, see [Configuring Keycloak](/greenlight_v3/gl3-keycloak.html#connecting-to-keycloak).
If you have an already running Greenlight v2 instance and thinking about how to migrate your data to v3, see [Migrating from Greenlight v2](/greenlight_v3/gl3-migration.html).
